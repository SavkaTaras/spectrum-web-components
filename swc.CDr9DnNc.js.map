{"version":3,"file":"swc.IJMzrq18.js","sources":["../../../tools/reactive-controllers/src/FocusGroup.js"],"sourcesContent":["\"use strict\";function o(i,e,t){return typeof i===e?()=>i:typeof i==\"function\"?i:t}export class FocusGroupController{constructor(e,{direction:t,elementEnterAction:n,elements:s,focusInIndex:r,isFocusableElement:h,listenerScope:c}={elements:()=>[]}){this._currentIndex=-1;this.prevIndex=-1;this._direction=()=>\"both\";this.directionLength=5;this.elementEnterAction=e=>{};this._focused=!1;this._focusInIndex=e=>0;this.isFocusableElement=e=>!0;this._listenerScope=()=>this.host;this.offset=0;this.recentlyConnected=!1;this.handleFocusin=e=>{if(!this.isEventWithinListenerScope(e))return;this.isRelatedTargetOrContainAnElement(e)&&this.hostContainsFocus();const t=e.composedPath();let n=-1;t.find(s=>(n=this.elements.indexOf(s),n!==-1)),this.prevIndex=this.currentIndex,this.currentIndex=n>-1?n:this.currentIndex};this.handleFocusout=e=>{this.isRelatedTargetOrContainAnElement(e)&&this.hostNoLongerContainsFocus()};this.handleKeydown=e=>{if(!this.acceptsEventCode(e.code)||e.defaultPrevented)return;let t=0;switch(this.prevIndex=this.currentIndex,e.code){case\"ArrowRight\":t+=1;break;case\"ArrowDown\":t+=this.direction===\"grid\"?this.directionLength:1;break;case\"ArrowLeft\":t-=1;break;case\"ArrowUp\":t-=this.direction===\"grid\"?this.directionLength:1;break;case\"End\":this.currentIndex=0,t-=1;break;case\"Home\":this.currentIndex=this.elements.length-1,t+=1;break}e.preventDefault(),this.direction===\"grid\"&&this.currentIndex+t<0?this.currentIndex=0:this.direction===\"grid\"&&this.currentIndex+t>this.elements.length-1?this.currentIndex=this.elements.length-1:this.setCurrentIndexCircularly(t),this.elementEnterAction(this.elements[this.currentIndex]),this.focus()};this.mutationObserver=new MutationObserver(()=>{this.handleItemMutation()}),this.host=e,this.host.addController(this),this._elements=s,this.isFocusableElement=h||this.isFocusableElement,this._direction=o(t,\"string\",this._direction),this.elementEnterAction=n||this.elementEnterAction,this._focusInIndex=o(r,\"number\",this._focusInIndex),this._listenerScope=o(c,\"object\",this._listenerScope)}get currentIndex(){return this._currentIndex===-1&&(this._currentIndex=this.focusInIndex),this._currentIndex-this.offset}set currentIndex(e){this._currentIndex=e+this.offset}get direction(){return this._direction()}get elements(){return this.cachedElements||(this.cachedElements=this._elements()),this.cachedElements}set focused(e){e!==this.focused&&(this._focused=e)}get focused(){return this._focused}get focusInElement(){return this.elements[this.focusInIndex]}get focusInIndex(){return this._focusInIndex(this.elements)}isEventWithinListenerScope(e){return this._listenerScope()===this.host?!0:e.composedPath().includes(this._listenerScope())}handleItemMutation(){if(this._currentIndex==-1||this.elements.length<=this._elements().length)return;const e=this.elements[this.currentIndex];if(this.clearElementCache(),this.elements.includes(e))return;const t=this.currentIndex!==this.elements.length,n=t?1:-1;t&&this.setCurrentIndexCircularly(-1),this.setCurrentIndexCircularly(n),this.focus()}update({elements:e}={elements:()=>[]}){this.unmanage(),this._elements=e,this.clearElementCache(),this.manage()}focus(e){var s;const t=this.elements;if(!t.length)return;let n=t[this.currentIndex];(!n||!this.isFocusableElement(n))&&(this.setCurrentIndexCircularly(1),n=t[this.currentIndex]),n&&this.isFocusableElement(n)&&((s=t[this.prevIndex])==null||s.setAttribute(\"tabindex\",\"-1\"),n.tabIndex=0,n.focus(e))}clearElementCache(e=0){this.mutationObserver.disconnect(),delete this.cachedElements,this.offset=e,requestAnimationFrame(()=>{this.elements.forEach(t=>{this.mutationObserver.observe(t,{attributes:!0})})})}setCurrentIndexCircularly(e){const{length:t}=this.elements;let n=t;this.prevIndex=this.currentIndex;let s=(t+this.currentIndex+e)%t;for(;n&&this.elements[s]&&!this.isFocusableElement(this.elements[s]);)s=(t+s+e)%t,n-=1;this.currentIndex=s}hostContainsFocus(){this.host.addEventListener(\"focusout\",this.handleFocusout),this.host.addEventListener(\"keydown\",this.handleKeydown),this.focused=!0}hostNoLongerContainsFocus(){this.host.addEventListener(\"focusin\",this.handleFocusin),this.host.removeEventListener(\"focusout\",this.handleFocusout),this.host.removeEventListener(\"keydown\",this.handleKeydown),this.focused=!1}isRelatedTargetOrContainAnElement(e){const t=e.relatedTarget,n=this.elements.includes(t),s=this.elements.some(r=>r.contains(t));return!(n||s)}acceptsEventCode(e){if(e===\"End\"||e===\"Home\")return!0;switch(this.direction){case\"horizontal\":return e===\"ArrowLeft\"||e===\"ArrowRight\";case\"vertical\":return e===\"ArrowUp\"||e===\"ArrowDown\";case\"both\":case\"grid\":return e.startsWith(\"Arrow\")}}manage(){this.addEventListeners()}unmanage(){this.removeEventListeners()}addEventListeners(){this.host.addEventListener(\"focusin\",this.handleFocusin)}removeEventListeners(){this.host.removeEventListener(\"focusin\",this.handleFocusin),this.host.removeEventListener(\"focusout\",this.handleFocusout),this.host.removeEventListener(\"keydown\",this.handleKeydown)}hostConnected(){this.recentlyConnected=!0,this.addEventListeners()}hostDisconnected(){this.mutationObserver.disconnect(),this.removeEventListeners()}hostUpdated(){this.recentlyConnected&&(this.recentlyConnected=!1,this.elements.forEach(e=>{this.mutationObserver.observe(e,{attributes:!0})}))}}\n//# sourceMappingURL=FocusGroup.js.map\n"],"names":["o","i","e","t","FocusGroupController","constructor","direction","elementEnterAction","n","elements","s","focusInIndex","r","isFocusableElement","h","listenerScope","c","this","_currentIndex","prevIndex","_direction","directionLength","_focused","_focusInIndex","_listenerScope","host","offset","recentlyConnected","handleFocusin","isEventWithinListenerScope","isRelatedTargetOrContainAnElement","hostContainsFocus","composedPath","find","indexOf","currentIndex","handleFocusout","hostNoLongerContainsFocus","handleKeydown","acceptsEventCode","code","defaultPrevented","length","preventDefault","setCurrentIndexCircularly","focus","mutationObserver","MutationObserver","handleItemMutation","addController","_elements","cachedElements","focused","focusInElement","includes","clearElementCache","update","unmanage","manage","setAttribute","tabIndex","disconnect","requestAnimationFrame","forEach","observe","attributes","addEventListener","removeEventListener","relatedTarget","some","contains","startsWith","addEventListeners","removeEventListeners","hostConnected","hostDisconnected","hostUpdated"],"mappings":"AAuBA,SAASA,EACLC,EACAC,EACAC,GAEA,cAAWF,IAAUC,EACT,IAAMD,EACU,mBAAVA,EACPA,EAEJE,EAGE,MAAAC,EAmFTC,WAAAA,CACIH,GAEII,UAAAH,EACAI,mBAAAC,EACAC,SAAAC,EACAC,aAAAC,EACAC,mBAAAC,EACAC,cAAAC,GACqB,CAAEP,SAAUA,IAAM,KA3E/CQ,KAAQC,eAAgB,EAExBD,KAAQE,WAAY,EAMpBF,KAAAG,WAAa,IAAsB,OAEnCH,KAAOI,gBAAkB,EAEzBJ,KAAAV,mBAAsBL,MAuBtBe,KAAQK,UAAW,EAWnBL,KAAAM,cAAiBrB,GAA2B,EAK5Ce,KAAAJ,mBAAsBX,IAAoB,EAO1Ce,KAAAO,eAAiB,IAAmBP,KAAKQ,KAIzCR,KAAAS,OAAS,EAETT,KAAAU,mBAAoB,EA0IpBV,KAAAW,cAAiB1B,IACb,IAAKe,KAAKY,2BAA2B3B,GAAQ,OACzCe,KAAKa,kCAAkC5B,IACvCe,KAAKc,oBAET,MAAM5B,EAAOD,EAAM8B,eACnB,IAAIxB,GAAc,EAClBL,EAAK8B,MAAMvB,IACPF,EAAcS,KAAKR,SAASyB,QAAQxB,IAEvC,IADUF,KAEXS,KAAKE,UAAYF,KAAKkB,aACtBlB,KAAKkB,aAAe3B,KAAmBA,EAAcS,KAAKkB,YAC9D,EAEAlB,KAAAmB,eAAkBlC,IACVe,KAAKa,kCAAkC5B,IACvCe,KAAKoB,2BAEb,EAiBApB,KAAAqB,cAAiBpC,IACb,IAAKe,KAAKsB,iBAAiBrC,EAAMsC,OAAStC,EAAMuC,iBAC5C,OAEJ,IAAItC,EAAO,EAEX,OADAc,KAAKE,UAAYF,KAAKkB,aACdjC,EAAMsC,MACV,IAAK,aACDrC,GAAQ,EACR,MACJ,IAAK,YACDA,GAA2B,SAAnBc,KAAKX,UAAuBW,KAAKI,gBAAkB,EAC3D,MACJ,IAAK,YACDlB,GAAQ,EACR,MACJ,IAAK,UACDA,GAA2B,SAAnBc,KAAKX,UAAuBW,KAAKI,gBAAkB,EAC3D,MACJ,IAAK,MACDJ,KAAKkB,aAAe,EACpBhC,GAAQ,EACR,MACJ,IAAK,OACDc,KAAKkB,aAAelB,KAAKR,SAASiC,OAAS,EAC3CvC,GAAQ,EAGhBD,EAAMyC,iBACiB,SAAnB1B,KAAKX,WAAwBW,KAAKkB,aAAehC,EAAO,EACxDc,KAAKkB,aAAe,EAED,SAAnBlB,KAAKX,WACLW,KAAKkB,aAAehC,EAAOc,KAAKR,SAASiC,OAAS,EAElDzB,KAAKkB,aAAelB,KAAKR,SAASiC,OAAS,EAE3CzB,KAAK2B,0BAA0BzC,GAInCc,KAAKV,mBAAmBU,KAAKR,SAASQ,KAAKkB,eAC3ClB,KAAK4B,OACT,EA5MI5B,KAAK6B,iBAAmB,IAAIC,kBAAiB,KACzC9B,KAAK+B,oBACT,IACA/B,KAAKQ,KAAOvB,EACZe,KAAKQ,KAAKwB,cAAchC,MACxBA,KAAKiC,UAAYxC,EACjBO,KAAKJ,mBAAqBC,GAAsBG,KAAKJ,mBACrDI,KAAKG,WAAapB,EACdG,EACA,SACAc,KAAKG,YAETH,KAAKV,mBAAqBC,GAAsBS,KAAKV,mBACrDU,KAAKM,cAAgBvB,EACjBY,EACA,SACAK,KAAKM,eAETN,KAAKO,eAAiBxB,EAClBgB,EACA,SACAC,KAAKO,eA7Gb,CAAA,gBAAIW,GACA,OAA2B,IAAlBjB,KAAAA,gBACLD,KAAKC,cAAgBD,KAAKN,cAEvBM,KAAKC,cAAgBD,KAAKS,MACrC,CAEA,gBAAIS,CAAajC,GACbe,KAAKC,cAAgBhB,EAAee,KAAKS,MAC7C,CAMA,aAAIpB,GACA,OAAOW,KAAKG,YAWhB,CAAA,YAAIX,GACA,OAAU0C,KAAAA,iBACNlC,KAAKkC,eAAiBlC,KAAKiC,aAExBjC,KAAKkC,cAKhB,CAAA,WAAcC,CAAQlD,GAEdA,IAAYe,KAAKmC,UACrBnC,KAAKK,SAAWpB,EACpB,CAEA,WAAckD,GACV,YAAY9B,QAChB,CAIA,kBAAI+B,GACA,OAAOpC,KAAKR,SAASQ,KAAKN,aAG9B,CAAA,gBAAIA,GACA,OAAYY,KAAAA,cAAcN,KAAKR,SACnC,CAUAoB,0BAAAA,CAA2B3B,GACvB,OAASsB,KAAAA,mBAAqBP,KAAKQ,MAC5BvB,EAAM8B,eAAesB,SAASrC,KAAKO,iBAC9C,CAgDAwB,kBAAAA,GACI,IAEI,GADA/B,KAAKC,eACLD,KAAKR,SAASiC,QAAUzB,KAAKiC,YAAYR,OAEzC,OACJ,MAAMxC,EAAiBe,KAAKR,SAASQ,KAAKkB,cAE1C,GADAlB,KAAKsC,oBACDtC,KAAKR,SAAS6C,SAASpD,GAAiB,OAC5C,MAAMC,EAAoBc,KAAKkB,eAAiBlB,KAAKR,SAASiC,OACxDlC,EAAOL,EAAoB,GAC7BA,EAAAA,GACAc,KAAK2B,2BAA0B,GAEnC3B,KAAK2B,0BAA0BpC,GAC/BS,KAAK4B,OAGTW,CAAAA,MAAAA,EAAS/C,SAAAP,GAAkC,CAAEO,SAAUA,IAAM,KACzDQ,KAAKwC,WACLxC,KAAKiC,UAAYhD,EACjBe,KAAKsC,oBACLtC,KAAKyC,QAGTb,CAAAA,KAAAA,CAAM3C,GAtLV,IAAAQ,EAuLQ,MAAMP,EAAWc,KAAKR,SACtB,IAAKN,EAASuC,OAAQ,OACtB,IAAIlC,EAAeL,EAASc,KAAKkB,gBAC5B3B,IAAiBS,KAAKJ,mBAAmBL,MAC1CS,KAAK2B,0BAA0B,GAC/BpC,EAAeL,EAASc,KAAKkB,eAE7B3B,GAAgBS,KAAKJ,mBAAmBL,KACxC,OAAAE,EAAAP,EAASc,KAAKE,aAAdT,EAA0BiD,aAAa,WAAY,MACnDnD,EAAaoD,SAAW,EACxBpD,EAAaqC,MAAM3C,IAI3BqD,iBAAAA,CAAkBrD,EAAS,GACvBe,KAAK6B,iBAAiBe,oBACf5C,KAAKkC,eACZlC,KAAKS,OAASxB,EACd4D,uBAAsB,KAClB7C,KAAKR,SAASsD,SAAS5D,IACnBc,KAAK6B,iBAAiBkB,QAAQ7D,EAAS,CACnC8D,YAAY,GAEpB,GACJ,GACJ,CAEArB,yBAAAA,CAA0B1C,GACtB,MAAQwC,OAAAvC,GAAWc,KAAKR,SACxB,IAAID,EAAQL,EACZc,KAAKE,UAAYF,KAAKkB,aAEtB,IAAIzB,GAAaP,EAASc,KAAKkB,aAAejC,GAAQC,EACtD,KAEIK,GACAS,KAAKR,SAASC,KACbO,KAAKJ,mBAAmBI,KAAKR,SAASC,KAEvCA,GAAaP,EAASO,EAAYR,GAAQC,EAC1CK,GAAS,EAEbS,KAAKkB,aAAezB,CAGxBqB,CAAAA,iBAAAA,GACId,KAAKQ,KAAKyC,iBAAiB,WAAYjD,KAAKmB,gBAC5CnB,KAAKQ,KAAKyC,iBAAiB,UAAWjD,KAAKqB,eAC3CrB,KAAKmC,SAAU,EAGnBf,yBAAAA,GACIpB,KAAKQ,KAAKyC,iBAAiB,UAAWjD,KAAKW,eAC3CX,KAAKQ,KAAK0C,oBAAoB,WAAYlD,KAAKmB,gBAC/CnB,KAAKQ,KAAK0C,oBAAoB,UAAWlD,KAAKqB,eAC9CrB,KAAKmC,SAAU,CACnB,CAEAtB,iCAAAA,CAAkC5B,GAC9B,MAAMC,EAAgBD,EAAMkE,cAEtB5D,EAA2BS,KAAKR,SAAS6C,SAC3CnD,GAEEO,EAAyCO,KAAKR,SAAS4D,MACxDzD,GAAOA,EAAG0D,SAASnE,KAExB,QACIK,GAA4BE,EAEpC,CAuBA6B,gBAAAA,CAAiBrC,GACb,GAAa,QAATA,GAA2B,SAATA,EAClB,OAAO,EAEX,OAAQe,KAAKX,WACT,IAAK,aACD,MAAgB,cAATJ,GAAiC,eAATA,EACnC,IAAK,WACD,MAAgB,YAATA,GAA+B,cAATA,EACjC,IAAK,OACL,IAAK,OACD,OAAOA,EAAKqE,WAAW,SAEnC,CA+CAb,MAAAA,GACIzC,KAAKuD,mBACT,CAEAf,QAAAA,GACIxC,KAAKwD,sBAGTD,CAAAA,iBAAAA,GACIvD,KAAKQ,KAAKyC,iBAAiB,UAAWjD,KAAKW,cAC/C,CAEA6C,oBAAAA,GACIxD,KAAKQ,KAAK0C,oBAAoB,UAAWlD,KAAKW,eAC9CX,KAAKQ,KAAK0C,oBAAoB,WAAYlD,KAAKmB,gBAC/CnB,KAAKQ,KAAK0C,oBAAoB,UAAWlD,KAAKqB,cAGlDoC,CAAAA,aAAAA,GACIzD,KAAKU,mBAAoB,EACzBV,KAAKuD,mBAGTG,CAAAA,gBAAAA,GACI1D,KAAK6B,iBAAiBe,aACtB5C,KAAKwD,sBAGTG,CAAAA,WAAAA,GACQ3D,KAAKU,oBACLV,KAAKU,mBAAoB,EACzBV,KAAKR,SAASsD,SAAS7D,IACnBe,KAAK6B,iBAAiBkB,QAAQ9D,EAAS,CACnC+D,YAAY,GAEpB,IAGZ"}