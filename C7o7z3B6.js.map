{"version":3,"file":"C7o7z3B6.js","sources":["../../../tools/reactive-controllers/src/FocusGroup.js"],"sourcesContent":["\"use strict\";function r(i,e,t){return typeof i===e?()=>i:typeof i==\"function\"?i:t}export class FocusGroupController{constructor(e,{direction:t,elementEnterAction:n,elements:s,focusInIndex:o,isFocusableElement:h,listenerScope:c}={elements:()=>[]}){this._currentIndex=-1;this._direction=()=>\"both\";this.directionLength=5;this.elementEnterAction=e=>{};this._focused=!1;this._focusInIndex=e=>0;this.isFocusableElement=e=>!0;this._listenerScope=()=>this.host;this.offset=0;this.recentlyConnected=!1;this.handleFocusin=e=>{if(!this.isEventWithinListenerScope(e))return;this.isRelatedTargetAnElement(e)&&this.hostContainsFocus();const t=e.composedPath();let n=-1;t.find(s=>(n=this.elements.indexOf(s),n!==-1)),this.currentIndex=n>-1?n:this.currentIndex};this.handleFocusout=e=>{this.isRelatedTargetAnElement(e)&&this.hostNoLongerContainsFocus()};this.handleKeydown=e=>{if(!this.acceptsEventCode(e.code)||e.defaultPrevented)return;let t=0;switch(e.code){case\"ArrowRight\":t+=1;break;case\"ArrowDown\":t+=this.direction===\"grid\"?this.directionLength:1;break;case\"ArrowLeft\":t-=1;break;case\"ArrowUp\":t-=this.direction===\"grid\"?this.directionLength:1;break;case\"End\":this.currentIndex=0,t-=1;break;case\"Home\":this.currentIndex=this.elements.length-1,t+=1;break}e.preventDefault(),this.direction===\"grid\"&&this.currentIndex+t<0?this.currentIndex=0:this.direction===\"grid\"&&this.currentIndex+t>this.elements.length-1?this.currentIndex=this.elements.length-1:this.setCurrentIndexCircularly(t),this.elementEnterAction(this.elements[this.currentIndex]),this.focus()};this.mutationObserver=new MutationObserver(()=>{this.handleItemMutation()}),this.host=e,this.host.addController(this),this._elements=s,this.isFocusableElement=h||this.isFocusableElement,this._direction=r(t,\"string\",this._direction),this.elementEnterAction=n||this.elementEnterAction,this._focusInIndex=r(o,\"number\",this._focusInIndex),this._listenerScope=r(c,\"object\",this._listenerScope)}get currentIndex(){return this._currentIndex===-1&&(this._currentIndex=this.focusInIndex),this._currentIndex-this.offset}set currentIndex(e){this._currentIndex=e+this.offset}get direction(){return this._direction()}get elements(){return this.cachedElements||(this.cachedElements=this._elements()),this.cachedElements}set focused(e){e!==this.focused&&(this._focused=e)}get focused(){return this._focused}get focusInElement(){return this.elements[this.focusInIndex]}get focusInIndex(){return this._focusInIndex(this.elements)}isEventWithinListenerScope(e){return this._listenerScope()===this.host?!0:e.composedPath().includes(this._listenerScope())}handleItemMutation(){if(this._currentIndex==-1||this.elements.length<=this._elements().length)return;const e=this.elements[this.currentIndex];if(this.clearElementCache(),this.elements.includes(e))return;const t=this.currentIndex!==this.elements.length,n=t?1:-1;t&&this.setCurrentIndexCircularly(-1),this.setCurrentIndexCircularly(n),this.focus()}update({elements:e}={elements:()=>[]}){this.unmanage(),this._elements=e,this.clearElementCache(),this.manage()}focus(e){const t=this.elements;if(!t.length)return;let n=t[this.currentIndex];(!n||!this.isFocusableElement(n))&&(this.setCurrentIndexCircularly(1),n=t[this.currentIndex]),n&&this.isFocusableElement(n)&&n.focus(e)}clearElementCache(e=0){this.mutationObserver.disconnect(),delete this.cachedElements,this.offset=e,requestAnimationFrame(()=>{this.elements.forEach(t=>{this.mutationObserver.observe(t,{attributes:!0})})})}setCurrentIndexCircularly(e){const{length:t}=this.elements;let n=t,s=(t+this.currentIndex+e)%t;for(;n&&this.elements[s]&&!this.isFocusableElement(this.elements[s]);)s=(t+s+e)%t,n-=1;this.currentIndex=s}hostContainsFocus(){this.host.addEventListener(\"focusout\",this.handleFocusout),this.host.addEventListener(\"keydown\",this.handleKeydown),this.focused=!0}hostNoLongerContainsFocus(){this.host.addEventListener(\"focusin\",this.handleFocusin),this.host.removeEventListener(\"focusout\",this.handleFocusout),this.host.removeEventListener(\"keydown\",this.handleKeydown),this.focused=!1}isRelatedTargetAnElement(e){const t=e.relatedTarget;return!this.elements.includes(t)}acceptsEventCode(e){if(e===\"End\"||e===\"Home\")return!0;switch(this.direction){case\"horizontal\":return e===\"ArrowLeft\"||e===\"ArrowRight\";case\"vertical\":return e===\"ArrowUp\"||e===\"ArrowDown\";case\"both\":case\"grid\":return e.startsWith(\"Arrow\")}}manage(){this.addEventListeners()}unmanage(){this.removeEventListeners()}addEventListeners(){this.host.addEventListener(\"focusin\",this.handleFocusin)}removeEventListeners(){this.host.removeEventListener(\"focusin\",this.handleFocusin),this.host.removeEventListener(\"focusout\",this.handleFocusout),this.host.removeEventListener(\"keydown\",this.handleKeydown)}hostConnected(){this.recentlyConnected=!0,this.addEventListeners()}hostDisconnected(){this.mutationObserver.disconnect(),this.removeEventListeners()}hostUpdated(){this.recentlyConnected&&(this.recentlyConnected=!1,this.elements.forEach(e=>{this.mutationObserver.observe(e,{attributes:!0})}))}}\n//# sourceMappingURL=FocusGroup.js.map\n"],"names":["r","i","e","t","FocusGroupController","constructor","direction","elementEnterAction","n","elements","s","focusInIndex","o","isFocusableElement","h","listenerScope","c","this","_currentIndex","_direction","directionLength","_focused","_focusInIndex","_listenerScope","host","offset","recentlyConnected","handleFocusin","isEventWithinListenerScope","isRelatedTargetAnElement","hostContainsFocus","composedPath","find","indexOf","currentIndex","handleFocusout","hostNoLongerContainsFocus","handleKeydown","acceptsEventCode","code","defaultPrevented","length","preventDefault","setCurrentIndexCircularly","focus","mutationObserver","MutationObserver","handleItemMutation","addController","_elements","cachedElements","focused","focusInElement","includes","clearElementCache","update","unmanage","manage","disconnect","requestAnimationFrame","forEach","observe","attributes","addEventListener","removeEventListener","relatedTarget","startsWith","addEventListeners","removeEventListeners","hostConnected","hostDisconnected","hostUpdated"],"mappings":"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"}